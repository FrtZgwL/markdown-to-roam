
document = []

def process_lines_below(line_gen, parent, level):
    for line in line_gen:
        if line is text:
            parent["children"].add(line)
        elif line is heading:
            lower level:
                next_line = process_lines_below(line_gen, line, line.level)

                if next_line.level = level
            higher level:
                return line

